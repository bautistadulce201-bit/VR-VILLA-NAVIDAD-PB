<!DOCTYPE html>
<html lang="en">
<head>
    <title>Navidad PB VR </title>
    <link rel="icon" type="image/png" href="./image/f1.png"/> 
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body> <canvas id="myCanvas"></canvas>

<script src="./font/01.js"></script>  
<script src="./font/02.js"></script>  
<script src="./font/03.js"></script> 

<script type="importmap">
{
    "imports": {
        "three": "./js/three.module.js",
        "three/VRButton": "./js/VRButton.js",
        "three/interactive": "./js/three.interactive.js" 
    }
}
</script>

<script type="module">
    import * as THREE from 'three';
    import { VRButton } from 'three/VRButton';
    // CORREGIDO: Faltaban estas importaciones vitales
    import { InteractionManager } from 'three/interactive';
    import { TWEEN } from './js/tween.module.min.js'; 
    
    import arbol from "./objetos/arbol.js";     
    import casa from "./objetos/casa.js";       
    import muneco from "./objetos/muneco.js";   
    import galleta from "./objetos/galleta.js"; 
    import duendes from "./objetos/duendes.js"; 
    import faro from "./objetos/faro.js";       
    import regalo from "./objetos/regalo.js";   

    /* ---------------- RENDERER ---------------- */
    var renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById('myCanvas'),
        antialias: true
    });
    // CORREGIDO: Typo 'decive' -> 'device'
    renderer.setPixelRatio(window.devicePixelRatio); 
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x85929E);
    
    // VR Setup
    renderer.xr.enabled = true; 
    renderer.xr.setReferenceSpaceType('local'); 
    
    document.body.appendChild(renderer.domElement);
    document.body.appendChild(VRButton.createButton(renderer));

    /* ---------------- ESCENA ---------------- */
    var scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050510); 
 
    //ðŸŽ¥ CÃ¡mara
    var camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 3000);
    camera.position.set(0, 120, 2000);

    // CORREGIDO: Inicializar InteractionManager (faltaba esto)
    var interactionManager = new InteractionManager(renderer, camera, renderer.domElement);

    /* ---------------- RESIZE ---------------- */
    window.addEventListener('resize', function(){
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // --- ILUMINACIÃ“N ---
    var ambientLight = new THREE.AmbientLight(0x404060, 0.5); 
    scene.add(ambientLight);

    var l1 = new THREE.DirectionalLight(0xffffff, 0.8);
    l1.position.set(-500, 1000, 500);
    l1.castShadow = true;
    l1.shadow.mapSize.width = 2048;
    l1.shadow.mapSize.height = 2048;
    l1.shadow.camera.far = 3000;
    scene.add(l1);

    var l2 = new THREE.PointLight(0xFFAA00, 10, 700);
    l2.position.set(0, 125, 400);  
    scene.add(l2);  

    var l3= new THREE.PointLight(0xFFAA00, 9, 800);
    l3.position.set(500, 100, -400); 
    scene.add(l3);

    // --- SUELO 
    var geometry01 = new THREE.PlaneGeometry(4000, 4000);
    var material01 = new THREE.MeshLambertMaterial({ color: 0x333344 });
    var mesh01 = new THREE.Mesh(geometry01, material01);
    mesh01.rotation.x = -1.5;
    mesh01.position.y = -5; 
    mesh01.receiveShadow = true; 
    scene.add(mesh01);

    // ==========================================
    //      EMPIEZA ELEMENTOS
    // ==========================================

    // 1. EL ÃRBOL
    var escenario1 = arbol({ x: 0, y: 0, z: 0 });
    scene.add(escenario1); 
    escenario1.position.set(0, -15, 700);
    escenario1.scale.set(3, 3, 3);
    escenario1.rotation.y = -1.5;  

    // 2. LA CASA 
    var escenario2 = casa({ x: 0, y: 0, z: 0 });
    scene.add(escenario2); 
    escenario2.position.set(0, 0, -700);
    escenario2.scale.set(5, 5, 5); 

    // 3. EL MUÃ‘ECO DE NIEVE 
    var escenario3 = muneco({ x: 0, y: 0, z: 0 });
    scene.add(escenario3); 
    escenario3.position.set(500, -53, 100);
    escenario3.scale.set(1.5, 1.5, 1.5); 
    escenario3.rotation.y = -1.5; 
    
    // 4. LA GALLETA
    var escenario4 = galleta({ x: 0, y: 0, z: 0 });
    scene.add(escenario4); 
    escenario4.position.set(-500, 100, 100);
    escenario4.scale.set(5, 5, 5); 
    escenario4.rotation.y = 1.5; 
    escenario4.receiveShadow = true;

    // ________Interacciones Galleta________
    escenario4.addEventListener('mouseover', (event) => {
        document.body.style.cursor = 'pointer';
        event.target.scale.set(5.4, 5.4, 5.4);
    });
    escenario4.addEventListener('mouseout', (event) => {
        document.body.style.cursor = 'default';
        event.target.scale.set(5, 5, 5);
    });
    escenario4.addEventListener('click', (event) => {
        var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
        new TWEEN.Tween(coords)
            .to({  x: -200, y: 80, z: 500 }, 1500) // AgreguÃ© tiempo 1500ms
            .easing(TWEEN.Easing.Quadratic.InOut) // AgreguÃ© suavizado
            .onUpdate(() => {
                camera.position.set(coords.x, coords.y, coords.z);
                camera.lookAt(-500, 100, 100); // Mirar a la galleta
            }) 
            .start();
    });
    interactionManager.add(escenario4); 
    
    // 5. DUENDES 
    var escenario5 = duendes({ x: 0, y: 0, z: 0 });
    scene.add(escenario5); 
    escenario5.position.set(-500, -110, 400); 
    escenario5.scale.set(9, 9, 9); 
    escenario5.rotation.y = 0.8; 
    escenario5.receiveShadow = true;

    // ________Interacciones Duendes________
    escenario5.addEventListener('mouseover', (event) => {
        document.body.style.cursor = 'pointer';
        event.target.scale.set(9.4, 9.4, 9.4);
    });
    escenario5.addEventListener('mouseout', (event) => {
        document.body.style.cursor = 'default';
        event.target.scale.set(9, 9, 9);
    });
    escenario5.addEventListener('click', (event) => {
        var coords = { x: camera.position.x, y: camera.position.y, z: camera.position.z };
        new TWEEN.Tween(coords)
            .to({ x:-250, y: 50, z: 650 }, 1500)
            .easing(TWEEN.Easing.Quadratic.InOut)
            .onUpdate(() => {
                camera.position.set(coords.x, coords.y, coords.z);
                camera.lookAt(-500, -110, 400); // Mirar a los duendes
            }) 
            .start();
    });
    interactionManager.add(escenario5); 
    
    // 6. FARO 
    var escenario6 = faro({ x: 0, y: 0, z: 0 });
    scene.add(escenario6); 
    escenario6.position.set(500, 0, -400); 
    escenario6.scale.set(9, 9, 9); 
    escenario6.rotation.y = 0.8; 
    escenario6.receiveShadow = true;

    
    /* ---------------- ANIMACIÃ“N ---------------- */
    ///ðŸŽ°ðŸŽ°Rendering y animaciÃ³n
function render (){
renderer.render(scene, camera);
requestAnimationFrame(render);
}
renderer.setAnimationLoop( render );
</script>
</body>
</html>
